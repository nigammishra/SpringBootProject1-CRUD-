<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Student Management</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 2rem;
  }
  h1 {
    color: #333;
  }
  form {
    margin-bottom: 1.5rem;
  }
  input, select {
    padding: 6px;
    margin: 4px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
  }
  th, td {
    border: 1px solid #999;
    padding: 8px;
    text-align: left;
  }
  th {
    background: #eee;
  }
  button {
    cursor: pointer;
    padding: 6px 12px;
  }
  .message {
    margin: 1rem 0;
    font-weight: bold;
  }
</style>
</head>
<body>
  <h1>Student Management System</h1>

  <form id="studentForm">
    <input type="hidden" id="studentId" />
    <label>
      Name:
      <input type="text" id="name" required />
    </label>
    <label>
      Gender:
      <select id="gender" required>
        <option value="">Select</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
    </label>
    <label>
      Date of Birth:
      <input type="date" id="dob" required />
    </label>
    <label>
      Age:
      <input type="number" id="age" min="1" required />
    </label>
    <button type="submit">Add / Update Student</button>
    <button type="button" id="cancelEdit" style="display:none;">Cancel Edit</button>
  </form>

  <div class="message" id="message"></div>

  <table>
    <thead>
      <tr><th>ID</th><th>Name</th><th>Gender</th><th>DOB</th><th>Age</th><th>Actions</th></tr>
    </thead>
    <tbody id="studentsTableBody"></tbody>
  </table>

<script >
  const baseURL = '/studentsManagementSystem/students';
  const form = document.getElementById('studentForm');
  const messageDiv = document.getElementById('message');
  const studentsTableBody = document.getElementById('studentsTableBody');
  const cancelEditBtn = document.getElementById('cancelEdit');

  // Load all students and render table
  async function loadStudents() {
    studentsTableBody.innerHTML = '';
    try {
      const res = await fetch(baseURL);
      if (!res.ok) throw new Error('Failed to fetch students');
      const students = await res.json();
      students.forEach(student => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${student.id}</td>
          <td>${student.name}</td>
          <td>${student.gender}</td>
          <td>${student.date_of_birth}</td>
          <td>${student.age}</td>
          <td>
            <button onclick="editStudent('${student.id}')">Edit</button>
            <button onclick="deleteStudent('${student.id}')">Delete</button>
          </td>
        `;
        studentsTableBody.appendChild(tr);
      });
    } catch (err) {
      showMessage(err.message, true);
    }
  }

  // Show message
  function showMessage(msg, isError = false) {
    messageDiv.textContent = msg;
    messageDiv.style.color = isError ? 'red' : 'green';
    setTimeout(() => { messageDiv.textContent = ''; }, 4000);
  }

  // Add or update student
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const id = document.getElementById('studentId').value;
    const studentData = {
      name: document.getElementById('name').value,
      gender: document.getElementById('gender').value,
      date_of_birth: document.getElementById('dob').value,
      age: Number(document.getElementById('age').value)
    };

    try {
      let res;
      if (id) {
        // Update existing
        res = await fetch(`${baseURL}/${id}`, {
          method: 'PUT',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(studentData)
        });
      } else {
        // Create new
        res = await fetch(baseURL, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(studentData)
        });
      }

      if (!res.ok) {
        const errMsg = await res.text();
        throw new Error(errMsg);
      }
      await loadStudents();
      showMessage(id ? 'Student updated successfully' : 'Student added successfully');

      form.reset();
      document.getElementById('studentId').value = '';
      cancelEditBtn.style.display = 'none';
    } catch (err) {
      showMessage(err.message, true);
    }
  });

  // Edit student (fill form with student data)
  async function editStudent(id) {
    try {
      const res = await fetch(`${baseURL}/${id}`);
      if (!res.ok) throw new Error('Student not found');
      const student = await res.json();
      document.getElementById('studentId').value = student.id;
      document.getElementById('name').value = student.name;
      document.getElementById('gender').value = student.gender;
      document.getElementById('dob').value = student.date_of_birth;
      document.getElementById('age').value = student.age;
      cancelEditBtn.style.display = 'inline';
    } catch (err) {
      showMessage(err.message, true);
    }
  }

  // Cancel editing
  cancelEditBtn.addEventListener('click', () => {
    form.reset();
    document.getElementById('studentId').value = '';
    cancelEditBtn.style.display = 'none';
  });

  // Delete student
  async function deleteStudent(id) {
    if (!confirm('Are you sure you want to delete this student?')) return;
    try {
      const res = await fetch(`${baseURL}/${id}`, { method: 'DELETE' });
      if (!res.ok) {
        const errMsg = await res.text();
        throw new Error(errMsg);
      }
      await loadStudents();
      showMessage('Student deleted successfully');
    } catch (err) {
      showMessage(err.message, true);
    }
  }

  // Initial load
  loadStudents();
</script>
</body>
</html>
